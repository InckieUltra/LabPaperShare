{"remainingRequest":"/Users/liujiaming/Documents/LabPaperShare-main/vue/node_modules/vue-loader-v16/dist/index.js??ref--0-1!/Users/liujiaming/Documents/LabPaperShare-main/vue/src/views/Upload.vue?vue&type=style&index=0&id=0ecd383b&scoped=true&lang=css","dependencies":[{"path":"/Users/liujiaming/Documents/LabPaperShare-main/vue/src/views/Upload.vue","mtime":1655035927968},{"path":"/Users/liujiaming/Documents/LabPaperShare-main/vue/node_modules/css-loader/dist/cjs.js","mtime":1651659848681},{"path":"/Users/liujiaming/Documents/LabPaperShare-main/vue/node_modules/vue-loader-v16/dist/stylePostLoader.js","mtime":1651659849395},{"path":"/Users/liujiaming/Documents/LabPaperShare-main/vue/node_modules/postcss-loader/src/index.js","mtime":1651659848884},{"path":"/Users/liujiaming/Documents/LabPaperShare-main/vue/node_modules/@vue/cli-service/node_modules/cache-loader/dist/cjs.js","mtime":1651659848347},{"path":"/Users/liujiaming/Documents/LabPaperShare-main/vue/node_modules/vue-loader-v16/dist/index.js","mtime":1651659849069}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5lbC10YWcgKyAuZWwtdGFnIHsKICBtYXJnaW4tbGVmdDogMTBweDsKfQouYnV0dG9uLW5ldy10YWcgewogIG1hcmdpbi1sZWZ0OiAxMHB4OwogIGhlaWdodDogMzJweDsKICBsaW5lLWhlaWdodDogMzBweDsKICBwYWRkaW5nLXRvcDogMDsKICBwYWRkaW5nLWJvdHRvbTogMDsKfQouaW5wdXQtbmV3LXRhZyB7CiAgd2lkdGg6IDkwcHg7CiAgbWFyZ2luLWxlZnQ6IDEwcHg7CiAgdmVydGljYWwtYWxpZ246IGJvdHRvbTsKfQo="},{"version":3,"sources":["/Users/liujiaming/Documents/LabPaperShare-main/vue/src/views/Upload.vue"],"names":[],"mappings":";AA6RA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EAChB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACnB;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACd,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACjB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACjB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;EACd,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC;AACnB;AACA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACb,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACjB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACxB","file":"/Users/liujiaming/Documents/LabPaperShare-main/vue/src/views/Upload.vue","sourceRoot":"","sourcesContent":["<template>\n  <el-card style=\"width: 50%;margin: 10px\" >\n    <div s>\n      <el-form ref=\"form\" :model=\"form\" :rules=\"rules\" label-width=\"80px\" >\n        <el-form-item label=\"论文标题\"  prop=\"title\" style=\"width: 50%\">\n          <el-input v-model=\"form.title\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"研究领域\" style=\"width: 50%\">\n\n        <div class=\"block\">\n            <el-cascader\n                v-model=\"tableData\"\n                :options=\"options\"\n                :props=\"props\"\n                clearable></el-cascader>\n        </div>\n        </el-form-item>\n\n        <el-form-item label=\"发布会议\" prop=\"conference\" style=\"width: 50%\">\n          <el-input v-model=\"form.conference\"></el-input>\n        </el-form-item>\n        <div style=\"display: inline-block\">\n          <el-form-item label=\"论文作者\"  style=\"width: 100%;\">\n            <el-tag\n                :key=\"author\"\n                v-for=\"author in form.authors\"\n                closable\n                :disable-transitions=\"false\"\n                @close=\"handleClose(author)\" style=\"\">\n              {{author}}\n            </el-tag>\n          </el-form-item>\n        </div>\n\n        <el-input\n            class=\"input-new-tag\"\n            v-if=\"inputVisible\"\n            v-model=\"inputValue\"\n            ref=\"saveTagInput\"\n            size=\"small\"\n            @keyup.enter.native=\"handleInputConfirm\"\n            @blur=\"handleInputConfirm\"\n        >\n        </el-input>\n        <el-button v-else class=\"button-new-tag\" size=\"small\" @click=\"showInput\">+新增作者</el-button>\n        <el-form-item label=\"论文摘要\" prop=\"summary\">\n          <el-input\n              type=\"textarea\"\n              :autosize=\"{ minRows: 2, maxRows: 4}\"\n              placeholder=\"请输入内容\"\n              v-model=\"form.summary\">\n          </el-input>\n        </el-form-item>\n        <el-form-item label=\"发布时间\" >\n          <el-col :span=\"11\">\n            <el-date-picker type=\"date\" placeholder=\"选择论文发表日期\" v-model=\"form.date\" style=\"width: 100%;\" value-format=\"yyyy-MM-dd\" ></el-date-picker>\n          </el-col>\n\n        </el-form-item>\n\n        <el-form-item label=\"论文类型\" >\n          <el-select v-model=\"form.type\" placeholder=\"请选择论文类型\" >\n            <el-option label=\"理论证明型\" value=\"理论证明型\" ></el-option>\n            <el-option label=\"综述型\" value=\"综述型\"></el-option>\n            <el-option label=\"实验型\" value=\"实验型\"></el-option>\n            <el-option label=\"工具型\" value=\"工具型\"></el-option>\n            <el-option label=\"数据集型\" value=\"数据集型\"></el-option>\n          </el-select>\n        </el-form-item>\n        <el-form-item label=\"论文链接\" style=\"width: 50%\">\n          <el-input v-model=\"form.link\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"引用文献\" >\n        <el-select\n            v-model=\"form.references\"\n            multiple\n            collapse-tags\n\n            placeholder=\"请选择\">\n          <el-option\n              v-for=\"item in refOptions\"\n              :key=\"item.paper_id\"\n              :label=\"item.title\"\n              :value=\"item.paper_id\">\n          </el-option>\n        </el-select>\n        </el-form-item>\n\n        <el-form-item label=\"笔记内容\">\n          <div id=\"div1\" style=\"position:relative; z-index: 0\">\n          </div>\n        </el-form-item>\n\n        <el-form-item label=\"附加文件\">\n          <el-upload\n              class=\"upload-demo\"\n              action=\"/api/file/upload?file\"\n              :on-preview=\"handlePreview\"\n              :on-remove=\"handleRemove\"\n              :on-success=\"handleSuccess\"\n              :on-error=\"handleError\"\n              :before-upload=\"beforeUpload\"\n              :before-remove=\"beforeRemove\"\n              multiple\n              :limit=\"3\"\n              :on-exceed=\"handleExceed\"\n              :file-list=\"files\">\n            <el-button size=\"small\" >点击上传</el-button>\n          </el-upload>\n\n        </el-form-item>\n\n        <el-form-item>\n          <el-button type=\"primary\" @click=\"onSubmit\">立即创建</el-button>\n          <el-button>取消</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </el-card>\n\n\n</template>\n\n<script>\nimport request from \"@/utils/request\";\n\nlet editor;\nimport E from 'wangeditor'\nexport default {\n  name: \"Upload\",\n  components:{\n  },\n  data() {\n    return {\n      rules: {\n        title: [\n          {required: true, message: '请输入论文标题', trigger: 'blur'}\n        ],\n        field: [\n          {required: true, message: '请输入邮箱', trigger: 'blur'},\n        ],\n        conference: [\n          {required: true, message: '请输入发布会议', trigger: 'blur'},\n        ],\n        summary: [\n          {required: true, message: '请输入论文摘要', trigger: 'blur'},\n        ],\n\n      },\n      props: { multiple: true,\n        checkStrictly: true,\n        value:'field_id',\n      label: 'field_name'\n      },\n      inputVisible: false,\n      inputValue: '',\n      tableData:[],\n      files:[],\n      form: {\n        user_id:'',\n        title: '',\n        date: '',\n        conference:'',\n        type: '',\n        content:\"\",\n        summary:'',\n        authors: [],\n        references:[],\n        link:'',\n        field: [],\n        fileList: []\n\n      },\n\n      options: [],\n      refOptions:[]\n    }\n  },\n  created() {\n    request.post(\"/api/allfield\").then(res => {\n      this.options = res.data\n    })\n    request.post(\"/api/findRef\").then(res => {\n      console.log(res.data)\n      this.refOptions = res.data[0]\n    })\n    //this.getTreeData(this.tableData)\n  },\n  mounted() {\n    this.init()\n    let userId = sessionStorage.getItem(\"user\")\n    this.form.user_id = JSON.parse(userId).user_id\n    console.log(this.form.user_id)\n  },\n  methods: {\n    handleRemove(file, fileList) {\n      console.log(file, fileList);\n    },\n    handleError(err,file,fileList){\n      console.log(err)\n    },\n    handleSuccess(res,file,fileList){\n      console.log(res)\n      this.form.fileList.push(res.data[0])\n      console.log(this.form.fileList)\n    },\n    beforeUpload(file) {\n      let fileSize = file.size\n      const FIVE_M= 5*1024*1024;\n      //大于5M，不允许上传\n      if(fileSize>FIVE_M){\n        this.$message.error(\"最大上传5M\")\n        return  false\n      }\n      //判断文件类型，必须是xlsx格式\n\n      return true\n    },\n    handlePreview(file) {\n      console.log(file);\n    },\n    handleExceed(files, fileList) {\n      this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);\n    },\n    beforeRemove(file, fileList) {\n      return this.$confirm(`确定移除 ${ file.name }？`);\n    },\n    onSubmit() {\n      // this.form.content = JSON.parse(JSON.stringify(this.BasicEditor.getHtml()))\n       console.log(this.form)\n      this.form.content = editor.txt.html()  // 获取 编辑器里面的值，然后赋予到实体当中\n\n      for(let i = 0;i<this.tableData.length;i++){\n        this.form.field.push(this.tableData[i][this.tableData[i].length-1])\n      }\n      request.post(\"/api/paper/upload\",this.form).then(res=>{\n        if (res.code === 0){\n          this.$message({\n            type: \"success\",\n            message: res.msg,\n          })\n        }else {\n          this.$message({\n            type: \"error\",\n            message: res.msg,\n          })\n        }\n      })\n\n      console.log('submit!');\n      console.log(this.form)\n    },\n    init(){\n      editor = new E('#div1')\n      // 或者 const editor = new E( document.getElementById('div1') )\n      editor.create()\n      editor.txt.html(\"\")\n\n    },\n  handleChange(value) {\n      console.log(value);\n    },\n    handleClose(author) {\n      this.form.authors.splice(this.form.authors.indexOf(author), 1);\n    },\n    showInput() {\n      this.inputVisible = true;\n      this.$nextTick(_ => {\n        this.$refs.saveTagInput.$refs.input.focus();\n      });\n    },\n\n    handleInputConfirm() {\n      let inputValue = this.inputValue;\n      if (inputValue) {\n        this.form.authors.push(inputValue);\n      }\n      this.inputVisible = false;\n      this.inputValue = '';\n    }\n  }\n}\n</script>\n\n<style scoped>\n.el-tag + .el-tag {\n  margin-left: 10px;\n}\n.button-new-tag {\n  margin-left: 10px;\n  height: 32px;\n  line-height: 30px;\n  padding-top: 0;\n  padding-bottom: 0;\n}\n.input-new-tag {\n  width: 90px;\n  margin-left: 10px;\n  vertical-align: bottom;\n}\n</style>\n"]}]}